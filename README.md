# The code and data for the paper "Aspect-Sentiment-Multiple-Opinion Triplet Extraction"

# Requirements
- Python 3.6.8
- torch==1.2.0
- pytorch-transformers==1.1.0
- allennlp==0.9.0

# Instructions:
. Before excuting the following commands, replace glove.840B.300d.txt(http://nlp.stanford.edu/data/wordvecs/glove.840B.300d.zip), bert-base-uncased.tar.gz(https://s3.amazonaws.com/models.huggingface.co/bert/bert-base-uncased.tar.gz) and vocab.txt(https://s3.amazonaws.com/models.huggingface.co/bert/bert-base-uncased-vocab.txt) with the corresponding absolute paths in your computer. 

# AGF
## ATE
sh repeat_non_bert.sh 7 4-ASMOTEDataRest14-0,4-ASMOTEDataRest14-1,4-ASMOTEDataRest14-2,4-ASMOTEDataRest14-3,4-ASMOTEDataRest14-4 nlp_tasks/absa/mining_opinions/sequence_labeling/ate_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataRest14 --data_type common_bert --model_name NerBert --train True --evaluate True --predict False --predict_test True --crf False --fixed_bert False > ate.4-ASMOTEDataRest14-0.log 2>&1 &

sh repeat_non_bert.sh 2 4-ASMOTEDataLapt14-0,4-ASMOTEDataLapt14-1,4-ASMOTEDataLapt14-2,4-ASMOTEDataLapt14-3,4-ASMOTEDataLapt14-4 nlp_tasks/absa/mining_opinions/sequence_labeling/ate_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataLapt14 --data_type common_bert --model_name NerBert --train True --evaluate True --predict False --predict_test True --crf False --fixed_bert False > ate.4-ASMOTEDataLapt14-0.log 2>&1 &

sh repeat_non_bert.sh 3 4-ASMOTEDataRest15-0,4-ASMOTEDataRest15-1,4-ASMOTEDataRest15-2,4-ASMOTEDataRest15-3,4-ASMOTEDataRest15-4 nlp_tasks/absa/mining_opinions/sequence_labeling/ate_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataRest15 --data_type common_bert --model_name NerBert --train True --evaluate True --predict False --predict_test True --crf False --fixed_bert False > ate.4-ASMOTEDataRest15-0.log 2>&1 &

sh repeat_non_bert.sh 3 4-ASMOTEDataRest16-0,4-ASMOTEDataRest16-1,4-ASMOTEDataRest16-2,4-ASMOTEDataRest16-3,4-ASMOTEDataRest16-4 nlp_tasks/absa/mining_opinions/sequence_labeling/ate_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataRest16 --data_type common_bert --model_name NerBert --train True --evaluate True --predict False --predict_test True --crf False --fixed_bert False > ate.4-ASMOTEDataRest16-0.log 2>&1 &

## TOWE and ATSA
sh repeat_non_bert.sh 7 10-ASMOTEDataRest14-0,10-ASMOTEDataRest14-1,10-ASMOTEDataRest14-2,10-ASMOTEDataRest14-3,10-ASMOTEDataRest14-4 nlp_tasks/absa/mining_opinions/sequence_labeling/aste_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataRest14 --data_type common_bert --model_name AsteTermBert --train True --evaluate True --predict False --crf False --position False --same_special_token False --aspect_term_aware True --lstm_layer_num_of_sentiment_specific 0 --sequence_label_attention True --softmax_after_opinion_logit False --validation_metric +opinion_sentiment_f1  --atsa_loss_weight 1 --towe_loss_weight 1 --towe_warmup True --fixed_bert False  --batch_size 64 --patience 5 --ate_result_filepath_template absa_asmote/ate/ASMOTEDataRest14/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataRest14-%d/1571400646/models/result_of_predicting_test.txt > aste.10-ASMOTEDataRest14-0.log 2>&1 &

sh repeat_non_bert.sh 3 10-ASMOTEDataLapt14-0,10-ASMOTEDataLapt14-1,10-ASMOTEDataLapt14-2,10-ASMOTEDataLapt14-3,10-ASMOTEDataLapt14-4 nlp_tasks/absa/mining_opinions/sequence_labeling/aste_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataLapt14 --data_type common_bert --model_name AsteTermBert --train True --evaluate True --predict False --crf False --position False --same_special_token False --aspect_term_aware True --lstm_layer_num_of_sentiment_specific 0 --sequence_label_attention True --softmax_after_opinion_logit False --validation_metric +opinion_sentiment_f1  --atsa_loss_weight 1 --towe_loss_weight 1 --towe_warmup True --fixed_bert False --ate_result_filepath_template absa/ate/ASMOTEDataLapt14/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataLapt14-%d/1571400646/models/result_of_predicting_test.txt > aste.10-ASMOTEDataLapt14-0.log 2>&1 &

sh repeat_non_bert.sh 3 10-ASMOTEDataRest15-0,10-ASMOTEDataRest15-1,10-ASMOTEDataRest15-2,10-ASMOTEDataRest15-3,10-ASMOTEDataRest15-4 nlp_tasks/absa/mining_opinions/sequence_labeling/aste_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataRest15 --data_type common_bert --model_name AsteTermBert --train True --evaluate True --predict False --crf False --position False --same_special_token False --aspect_term_aware True --lstm_layer_num_of_sentiment_specific 0 --sequence_label_attention True --softmax_after_opinion_logit False --validation_metric +opinion_sentiment_f1  --atsa_loss_weight 1 --towe_loss_weight 1 --towe_warmup True --fixed_bert False --ate_result_filepath_template absa/ate/ASMOTEDataRest15/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataRest15-%d/1571400646/models/result_of_predicting_test.txt > aste.10-ASMOTEDataRest15-0.log 2>&1 &

sh repeat_non_bert.sh 3 10-ASMOTEDataRest16-0,10-ASMOTEDataRest16-1,10-ASMOTEDataRest16-2,10-ASMOTEDataRest16-3,10-ASMOTEDataRest16-4 nlp_tasks/absa/mining_opinions/sequence_labeling/aste_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataRest16 --data_type common_bert --model_name AsteTermBert --train True --evaluate True --predict False --crf False --position False --same_special_token False --aspect_term_aware True --lstm_layer_num_of_sentiment_specific 0 --sequence_label_attention True --softmax_after_opinion_logit False --validation_metric +opinion_sentiment_f1   --atsa_loss_weight 1 --towe_loss_weight 1 --towe_warmup True --fixed_bert False --ate_result_filepath_template absa/ate/ASMOTEDataRest16/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataRest16-%d/1571400646/models/result_of_predicting_test.txt > aste.10-ASMOTEDataRest16-0.log 2>&1 &

## TOWE and ATSA inference
sh repeat_non_bert.sh 3 10-ASMOTEDataRest14-0,10-ASMOTEDataRest14-1,10-ASMOTEDataRest14-2,10-ASMOTEDataRest14-3,10-ASMOTEDataRest14-4 nlp_tasks/absa/mining_opinions/sequence_labeling/aste_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataRest14 --data_type common_bert --model_name AsteTermBert --train False --evaluate False --predict False --crf False --position False --same_special_token False --aspect_term_aware True --lstm_layer_num_of_sentiment_specific 0 --sequence_label_attention True --softmax_after_opinion_logit False --validation_metric +opinion_sentiment_f1  --atsa_loss_weight 1 --towe_loss_weight 1 --towe_warmup True --fixed_bert False --ate_result_filepath_template absa/ate/ASMOTEDataRest14/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataRest14-%d/1571400646/models/result_of_predicting_test.txt --add_predicted_aspect_term True

sh repeat_non_bert.sh 3 10-ASMOTEDataLapt14-0,10-ASMOTEDataLapt14-1,10-ASMOTEDataLapt14-2,10-ASMOTEDataLapt14-3,10-ASMOTEDataLapt14-4 nlp_tasks/absa/mining_opinions/sequence_labeling/aste_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataLapt14 --data_type common_bert --model_name AsteTermBert --train False --evaluate False --predict False --crf False --position False --same_special_token False --aspect_term_aware True --lstm_layer_num_of_sentiment_specific 0 --sequence_label_attention True --softmax_after_opinion_logit False --validation_metric +opinion_sentiment_f1  --atsa_loss_weight 1 --towe_loss_weight 1 --towe_warmup True --fixed_bert False --ate_result_filepath_template absa/ate/ASMOTEDataLapt14/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataLapt14-%d/1571400646/models/result_of_predicting_test.txt --add_predicted_aspect_term True

sh repeat_non_bert.sh 3 10-ASMOTEDataRest15-0,10-ASMOTEDataRest15-1,10-ASMOTEDataRest15-2,10-ASMOTEDataRest15-3,10-ASMOTEDataRest15-4 nlp_tasks/absa/mining_opinions/sequence_labeling/aste_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataRest15 --data_type common_bert --model_name AsteTermBert --train False --evaluate False --predict False --crf False --position False --same_special_token False --aspect_term_aware True --lstm_layer_num_of_sentiment_specific 0 --sequence_label_attention True --softmax_after_opinion_logit False --validation_metric +opinion_sentiment_f1  --atsa_loss_weight 1 --towe_loss_weight 1 --towe_warmup True --fixed_bert False --ate_result_filepath_template absa/ate/ASMOTEDataRest15/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataRest15-%d/1571400646/models/result_of_predicting_test.txt --add_predicted_aspect_term True

sh repeat_non_bert.sh 3 10-ASMOTEDataRest16-0,10-ASMOTEDataRest16-1,10-ASMOTEDataRest16-2,10-ASMOTEDataRest16-3,10-ASMOTEDataRest16-4 nlp_tasks/absa/mining_opinions/sequence_labeling/aste_bootstrap.py --embedding_filepath glove.840B.300d.txt --bert_file_path bert-base-uncased.tar.gz --bert_vocab_file_path uncased_L-12_H-768_A-12/vocab.txt --current_dataset ASMOTEDataRest16 --data_type common_bert --model_name AsteTermBert --train False --evaluate False --predict False --crf False --position False --same_special_token False --aspect_term_aware True --lstm_layer_num_of_sentiment_specific 0 --sequence_label_attention True --softmax_after_opinion_logit False --validation_metric +opinion_sentiment_f1   --atsa_loss_weight 1 --towe_loss_weight 1 --towe_warmup True --fixed_bert False --ate_result_filepath_template absa/ate/ASMOTEDataRest16/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataRest16-%d/1571400646/models/result_of_predicting_test.txt --add_predicted_aspect_term True

## evaluate
sh run.sh asmote_pipeline_evaluation_bootstrap.py --current_dataset ASMOTEDataRest14 --ate_result_filepath_template absa/ate/ASMOTEDataRest14/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataRest14-%d/1571400646/models/result_of_predicting_test.txt --atsa_result_filepath_template absa/aste/ASMOTEDataRest14/common_bert/model_name_AsteTermBert-include_conflict_False.10-ASMOTEDataRest14-%d/1571400646/models/result_of_predicting_test.txt.sentiment --towe_result_filepath_template absa/aste/ASMOTEDataRest14/common_bert/model_name_AsteTermBert-include_conflict_False.10-ASMOTEDataRest14-%d/1571400646/models/result_of_predicting_test.txt.opinion

sh run.sh asmote_pipeline_evaluation_bootstrap.py --current_dataset ASMOTEDataLapt14 --ate_result_filepath_template absa/ate/ASMOTEDataLapt14/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataLapt14-%d/1571400646/models/result_of_predicting_test.txt --atsa_result_filepath_template absa/aste/ASMOTEDataLapt14/common_bert/model_name_AsteTermBert-include_conflict_False.10-ASMOTEDataLapt14-%d/1571400646/models/result_of_predicting_test.txt.sentiment --towe_result_filepath_template absa/aste/ASMOTEDataLapt14/common_bert/model_name_AsteTermBert-include_conflict_False.10-ASMOTEDataLapt14-%d/1571400646/models/result_of_predicting_test.txt.opinion

sh run.sh asmote_pipeline_evaluation_bootstrap.py --current_dataset ASMOTEDataRest15 --ate_result_filepath_template absa/ate/ASMOTEDataRest15/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataRest15-%d/1571400646/models/result_of_predicting_test.txt --atsa_result_filepath_template absa/aste/ASMOTEDataRest15/common_bert/model_name_AsteTermBert-include_conflict_False.10-ASMOTEDataRest15-%d/1571400646/models/result_of_predicting_test.txt.sentiment --towe_result_filepath_template absa/aste/ASMOTEDataRest15/common_bert/model_name_AsteTermBert-include_conflict_False.10-ASMOTEDataRest15-%d/1571400646/models/result_of_predicting_test.txt.opinion

sh run.sh asmote_pipeline_evaluation_bootstrap.py --current_dataset ASMOTEDataRest16 --ate_result_filepath_template absa/ate/ASMOTEDataRest16/common_bert/model_name_NerBert-include_conflict_False.4-ASMOTEDataRest16-%d/1571400646/models/result_of_predicting_test.txt --atsa_result_filepath_template absa/aste/ASMOTEDataRest16/common_bert/model_name_AsteTermBert-include_conflict_False.10-ASMOTEDataRest16-%d/1571400646/models/result_of_predicting_test.txt.sentiment --towe_result_filepath_template absa/aste/ASMOTEDataRest16/common_bert/model_name_AsteTermBert-include_conflict_False.10-ASMOTEDataRest16-%d/1571400646/models/result_of_predicting_test.txt.opinion


# Citation
```
@inproceedings{wang2021aspect,
  title={Aspect-Sentiment-Multiple-Opinion Triplet Extraction},
  author={Wang, Fang and Li, Yuncong and Zhong, Sheng-hua and Yin, Cunxiang and He, Yancheng},
  booktitle={CCF International Conference on Natural Language Processing and Chinese Computing},
  pages={583--594},
  year={2021},
  organization={Springer}
}
```